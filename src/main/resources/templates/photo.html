<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Upload a Photo ‚Äì Knightfam</title>
    <!-- Bootstrap CSS -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"/>
    <style>
    body { background: #f8f9fa; padding-top: 80px; }
    .upload-card { max-width: 500px; margin: auto; }
  </style>
</head>
<body>
<!-- Navbar -->
<div th:replace="~{fragments/menu :: menu}"></div>

<div class="container py-5">
    <div class="card shadow upload-card">
        <div class="card-header bg-primary text-white text-center">
            <h3>üì§ Upload a Family Photo</h3>
        </div>
        <div class="card-body">
            <!-- note: posting to your JSON endpoint /api/photos/upload -->
            <form
                    id="uploadForm"
                    th:action="@{/api/photos/upload}"
                    method="post"
                    enctype="multipart/form-data"
            >
                <div class="mb-3">
                    <label for="title" class="form-label">Photo Title</label>
                    <input
                            type="text"
                            id="title"
                            name="title"
                            class="form-control"
                            placeholder="Enter a title"
                            required
                    />
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">Description</label>
                    <textarea
                            id="description"
                            name="description"
                            class="form-control"
                            rows="3"
                            placeholder="Optional description"
                    ></textarea>
                </div>

                <!-- big tappable file picker (no capture attribute!) -->
                <label
                        class="btn btn-outline-secondary w-100 mb-3 position-relative"
                        style="overflow:hidden"
                >
                    Choose Photo
                    <input
                            id="fileInput"
                            type="file"
                            name="file"
                            accept="image/*"
                            required
                            style="
                position:absolute;
                top:0; left:0;
                width:100%; height:100%;
                opacity:0;
                cursor:pointer;
              "
                    />
                </label>

                <noscript>
                    <div class="mb-3">
                        <input
                                type="file"
                                name="file"
                                accept="image/*"
                                class="form-control"
                                required
                        />
                    </div>
                    <button type="submit" class="btn btn-primary mb-3">
                        Upload Photo
                    </button>
                </noscript>

                <div class="d-flex justify-content-between">
                    <button
                            type="button"
                            class="btn btn-secondary"
                            onclick="history.back()"
                    >
                        ‚Üê Back
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document
      .getElementById('fileInput')
      .addEventListener('change', async function () {
        const form = document.getElementById('uploadForm');
        const formData = new FormData(form);

        try {
          const res = await fetch(form.action, {
            method: 'POST',
            body: formData,
            credentials: 'same-origin'    // <‚Äî include your session cookie
          });

          if (res.ok) {
            // on success, redirect to the gallery page
            window.location.href = '/gallery';
          } else {
            const text = await res.text();
            alert('Upload failed: ' + text);
          }
        } catch (err) {
          alert('Upload error: ' + err.message);
        }
      });
  </script>
</body>
</html>
